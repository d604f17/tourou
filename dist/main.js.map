{"version":3,"sources":["../src/main.js"],"names":["geocodeAPI","attractionAPI","geocode","flickr","cities","road","process","argv","length","toLowerCase","city","country","maxDistance","start","Date","getTime","query","then","attractions","location","results","waypoints","map","attraction","unshift","lng","lat","boundexBox","generateFromWaypoints","regression","x","Math","round","log","console","area","route","boxes","coordinates","_tour","vertex","y","origin","shift","destination","pop","join","legs","result","routes","distances","leg","distance","value","_heuristicDistance","_distance","reduce","a","b","_runtime","_graph","catch","error"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,aAAa,sBAAe,yCAAf,CAAnB;;AAEA,IAAMC,gBAAgB,0BAAkB;AACtCC,WAAS,yCAD6B;AAEtCC,UAAQ;AAF8B,CAAlB,CAAtB;;AAKA,IAAMC,SAAS;AACb,aAAW,yBADE;AAEb,gBAAc,oBAFD;AAGb,YAAU,gBAHG;AAIb,YAAU,cAJG;AAKb,YAAU,gBALG;AAMb,WAAS,mCANI;AAOb,oBAAkB,uBAPL;AAQb,UAAQ,YARK;AASb,iBAAe,oBATF;AAUb,eAAa,iBAVA;AAWb,mBAAiB,mBAXJ;AAYb,YAAU,cAZG;AAab,kBAAgB,mCAbH;AAcb,WAAS,aAdI;AAeb,iBAAe,iBAfF;AAgBb,UAAQ,kBAhBK;AAiBb,eAAa,eAjBA;AAkBb,YAAU,gBAlBG;AAmBb,YAAU,mBAnBG;AAoBb,cAAY,2BApBC;AAqBb,eAAa,mBArBA;AAsBb,UAAQ,cAtBK;AAuBb,eAAa,4BAvBA;AAwBb,cAAY,mBAxBC;AAyBb,YAAU,iBAzBG;AA0Bb,YAAU,qBA1BG;AA2Bb,WAAS,eA3BI;AA4Bb,YAAU,kBA5BG;AA6Bb,YAAU;AA7BG,CAAf;;AAgCA,IAAMC,OAAOC,QAAQC,IAAR,CAAaD,QAAQC,IAAR,CAAaC,MAAb,GAAsB,CAAnC,EAAsCC,WAAtC,EAAb;AACA,IAAMC,OAAOJ,QAAQC,IAAR,CAAaD,QAAQC,IAAR,CAAaC,MAAb,GAAsB,CAAnC,EAAsCC,WAAtC,EAAb;AACA,IAAME,UAAUL,QAAQC,IAAR,CAAaD,QAAQC,IAAR,CAAaC,MAAb,GAAsB,CAAnC,EAAsCC,WAAtC,EAAhB;AACA,IAAMG,cAAcN,QAAQC,IAAR,CAAaD,QAAQC,IAAR,CAAaC,MAAb,GAAsB,CAAnC,CAApB;;AAEA,IAAMK,QAAQ,IAAIC,IAAJ,GAAWC,OAAX,EAAd;;AAEA,IAAIL,QAAQN,MAAZ,EAAoB;AAClBH,gBAAce,KAAd,CAAoBZ,OAAOM,IAAP,CAApB,EAAkCO,IAAlC,CAAuC,uBAAe;AACpD,QAAIC,YAAYV,MAAhB,EAAwB;AACtBR,iBAAWgB,KAAX,CAAoBX,IAApB,UAA6BK,IAA7B,UAAsCC,OAAtC,EAAiDM,IAAjD,CAAsD,mBAAW;AAC/D,YAAME,WAAWjB,QAAQkB,OAAR,CAAgB,CAAhB,EAAmB,UAAnB,EAA+B,UAA/B,CAAjB;;AAEA,YAAMC,YAAYH,YAAYI,GAAZ,CAAgB,sBAAc;AAC9C,iBAAO,CACLC,WAAW,UAAX,EAAuB,KAAvB,CADK,EAELA,WAAW,UAAX,EAAuB,KAAvB,CAFK,EAGLA,WAAW,YAAX,CAHK,CAAP;AAID,SALiB,CAAlB;;AAOAF,kBAAUG,OAAV,CAAkB,CAACL,SAASM,GAAV,EAAeN,SAASO,GAAxB,EAA6B,CAA7B,CAAlB;;AAEA,YAAMC,aAAa,qBAAWC,qBAAX,CAAiCP,SAAjC,CAAnB;;AAEA,YAAMQ,aAAa,SAAbA,UAAa,CAACC,CAAD,EAAO;AACxB,iBAAOC,KAAKC,KAAL,CAAW,cAAcD,KAAKE,GAAL,CAASH,CAAT,CAAd,GAA4B,YAAvC,CAAP;AACD,SAFD;;AAIAI,gBAAQD,GAAR,CAAY,yBAAZ;AACA,uCAAgBZ,SAAhB,EAA2BQ,WAAWF,WAAWQ,IAAtB,CAA3B,EAAwDlB,IAAxD,CAA6D,iBAAS;AACpE,cAAMmB,QAAQ,oBAAKf,SAAL,EAAgBgB,KAAhB,EAAuB,EAACzB,wBAAD,EAAvB,CAAd;;AAEA,cAAM0B,cAAcF,MAAMG,KAAN,CAAYjB,GAAZ,CAAgB,kBAAU;AAC5C,mBAAOkB,OAAOC,CAAP,GAAW,GAAX,GAAiBD,OAAOV,CAA/B;AACD,WAFmB,CAApB;;AAIAI,kBAAQD,GAAR,CAAY,wBAAZ;AACA,+BAAWjB,KAAX,CAAiB;AACf0B,oBAAQJ,YAAYK,KAAZ,EADO;AAEfC,yBAAaN,YAAYO,GAAZ,EAFE;AAGfxB,uBAAWiB,YAAYQ,IAAZ,CAAiB,GAAjB;AAHI,WAAjB,EAIG7B,IAJH,CAIQ,kBAAU;AAChB,gBAAM8B,OAAOC,OAAOC,MAAP,CAAc,CAAd,EAAiB,MAAjB,CAAb;AACA,gBAAMC,YAAYH,KAAKzB,GAAL,CAAS;AAAA,qBAAO6B,IAAIC,QAAJ,CAAaC,KAApB;AAAA,aAAT,CAAlB;AACAjB,kBAAMkB,kBAAN,GAA2BlB,MAAMmB,SAAjC;AACAnB,kBAAMmB,SAAN,GAAkBL,UAAUM,MAAV,CAAiB,UAACC,CAAD,EAAIC,CAAJ;AAAA,qBAAUD,IAAIC,CAAd;AAAA,aAAjB,CAAlB;AACAtB,kBAAMmB,SAAN,IAAmB,QAAQR,KAAKvC,MAAL,GAAc,CAAtB,CAAnB;AACA4B,kBAAMuB,QAAN,GAAiB,IAAI7C,IAAJ,GAAWC,OAAX,KAAuBF,KAAxC;AACA,mBAAOuB,MAAMwB,MAAb;;AAEA,gBAAIxB,MAAMG,KAAN,CAAY/B,MAAZ,GAAqB,CAAzB,EAA4B;AAC1B0B,sBAAQD,GAAR,CAAYG,KAAZ;AACD,aAFD,MAEO;AACLF,sBAAQD,GAAR,CAAY,4CAAZ;AACD;AACF,WAlBD;AAmBD,SA3BD;AA4BD,OA/CD;AAgDD;AACF,GAnDD,EAmDG4B,KAnDH,CAmDS3B,QAAQ4B,KAnDjB;AAoDD","file":"main.js","sourcesContent":["import mmas from './mmas';\r\nimport directions from './directions';\r\nimport diagonalization from './strategies/diagonalization';\r\nimport AttractionAPI from './apis/attractions';\r\nimport GeocodeAPI from './apis/geocode';\r\nimport BoundedBox from './BoundedBox';\r\n\r\nconst geocodeAPI = new GeocodeAPI('AIzaSyAUMhnd_8pvLLYFvUkuAF612fXbLSSyCLc');\r\n\r\nconst attractionAPI = new AttractionAPI({\r\n  geocode: 'AIzaSyAUMhnd_8pvLLYFvUkuAF612fXbLSSyCLc',\r\n  flickr: '85f11febb88e3a4d49342a95b7bcf1e8',\r\n});\r\n\r\nconst cities = {\r\n  'aalborg': 'denmark/jutland/aalborg',\r\n  'copenhagen': 'denmark/copenhagen',\r\n  'aarhus': 'denmark/aarhus',\r\n  'madrid': 'spain/madrid',\r\n  'berlin': 'germany/berlin',\r\n  'perth': 'australia/western-australia/perth',\r\n  'rio de janeiro': 'brazil/rio-de-janeiro',\r\n  'rome': 'italy/rome',\r\n  'mexico city': 'mexico/mexico-city',\r\n  'barcelona': 'spain/barcelona',\r\n  'new york city': 'usa/new-york-city',\r\n  'venice': 'italy/venice',\r\n  'johannesburg': 'south-africa/gauteng/johannesburg',\r\n  'cairo': 'egypt/cairo',\r\n  'los angeles': 'usa/los-angeles',\r\n  'bern': 'switzerland/bern',\r\n  'las vegas': 'usa/las-vegas',\r\n  'london': 'england/london',\r\n  'dallas': '/usa/texas/dallas',\r\n  'honolulu': '/usa/honolulu-and-waikiki',\r\n  'stockholm': '/sweden/stockholm',\r\n  'oslo': '/norway/oslo',\r\n  'amsterdam': '/the-netherlands/amsterdam',\r\n  'brussels': '/belgium/brussels',\r\n  'vienna': '/austria/vienna',\r\n  'zurich': '/switzerland/zurich',\r\n  'paris': '/france/paris',\r\n  'lisbon': '/portugal/lisbon',\r\n  'athens': '/greece/athens',\r\n};\r\n\r\nconst road = process.argv[process.argv.length - 4].toLowerCase();\r\nconst city = process.argv[process.argv.length - 3].toLowerCase();\r\nconst country = process.argv[process.argv.length - 2].toLowerCase();\r\nconst maxDistance = process.argv[process.argv.length - 1];\r\n\r\nconst start = new Date().getTime();\r\n\r\nif (city in cities) {\r\n  attractionAPI.query(cities[city]).then(attractions => {\r\n    if (attractions.length) {\r\n      geocodeAPI.query(`${road}, ${city}, ${country}`).then(geocode => {\r\n        const location = geocode.results[0]['geometry']['location'];\r\n\r\n        const waypoints = attractions.map(attraction => {\r\n          return [\r\n            attraction['location']['lng'],\r\n            attraction['location']['lat'],\r\n            attraction['popularity']];\r\n        });\r\n\r\n        waypoints.unshift([location.lng, location.lat, 0]);\r\n\r\n        const boundexBox = BoundedBox.generateFromWaypoints(waypoints);\r\n\r\n        const regression = (x) => {\r\n          return Math.round(27.80137609 * Math.log(x) - 122.02143175);\r\n        };\r\n\r\n        console.log('running diagonalization');\r\n        diagonalization(waypoints, regression(boundexBox.area)).then(boxes => {\r\n          const route = mmas(waypoints, boxes, {maxDistance});\r\n\r\n          const coordinates = route._tour.map(vertex => {\r\n            return vertex.y + ',' + vertex.x;\r\n          });\r\n\r\n          console.log('fetching real distance');\r\n          directions.query({\r\n            origin: coordinates.shift(),\r\n            destination: coordinates.pop(),\r\n            waypoints: coordinates.join('|'),\r\n          }).then(result => {\r\n            const legs = result.routes[0]['legs'];\r\n            const distances = legs.map(leg => leg.distance.value);\r\n            route._heuristicDistance = route._distance;\r\n            route._distance = distances.reduce((a, b) => a + b);\r\n            route._distance += 2500 * (legs.length - 2);\r\n            route._runtime = new Date().getTime() - start;\r\n            delete route._graph;\r\n\r\n            if (route._tour.length > 2) {\r\n              console.log(route);\r\n            } else {\r\n              console.log('no route found with that maximum distance.');\r\n            }\r\n          });\r\n        });\r\n      });\r\n    }\r\n  }).catch(console.error);\r\n}\r\n"]}