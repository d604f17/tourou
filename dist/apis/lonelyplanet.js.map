{"version":3,"sources":["../../src/apis/lonelyplanet.js"],"names":["baseURL","getEndpoint","id","type","limit","offset","query","stringify","encode","resolve","encodeURIComponent","City","parts","split","country","city","pop","Promise","options","url","json","headers","then","result","data","map","Sight","name","sight","attributes","address","parameters","Object","assign","LonelyPlanetAPI","reject","$","load","body","href","attr","Error"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA,UAAU,+BAAhB;;AAEA,SAASC,WAAT,CAAqBC,EAArB,EAAoE;AAAA,MAA3CC,IAA2C,uEAApC,QAAoC;AAAA,MAA1BC,KAA0B,uEAAlB,IAAkB;AAAA,MAAZC,MAAY,uEAAH,CAAG;;AAClE,MAAMC,QAAQ,aAAGC,SAAH,CAAa;AACzB,qCAAiCJ,IADR;AAEzB,2CAAuCD,EAFd;AAGzB,mBAAeE,KAHU;AAIzB,oBAAgBC;AAJS,GAAb,EAKX,EAACG,QAAQ,KAAT,EALW,CAAd;;AAOA,SAAO,cAAIC,OAAJ,CAAYT,OAAZ,EAAqB,eAAaE,EAAb,kBAA8BQ,mBAAmB,WAAWJ,KAA9B,CAAnD,CAAP;AACD;;IAEKK,I;AACJ,gBAAYT,EAAZ,EAAgBI,KAAhB,EAAuB;AAAA;;AACrB,QAAIM,QAAQN,MAAMO,KAAN,CAAY,GAAZ,CAAZ;;AAEA,SAAKX,EAAL,GAAUA,EAAV;AACA,SAAKY,OAAL,GAAeF,MAAM,CAAN,CAAf;AACA,SAAKG,IAAL,GAAYH,MAAMI,GAAN,EAAZ;AACD;;;;6BAEQ;AAAA;;AACP,aAAO,IAAIC,OAAJ,CAAY,UAACR,OAAD,EAAa;AAC9B,YAAMS,UAAU;AACdC,eAAKlB,YAAY,MAAKC,EAAjB,CADS;AAEdkB,gBAAM,IAFQ;AAGdC,mBAAS;AACP,4BAAgB;AADT;AAHK,SAAhB;;AAQA,sCAAGH,OAAH,EAAYI,IAAZ,CAAiB,kBAAU;AACzBb,kBAAQc,OAAOC,IAAP,CAAYC,GAAZ,CAAgB,iBAAS;AAC/B,mBAAO,IAAIC,KAAJ,QAAgB;AACrBC,oBAAMC,MAAMC,UAAN,CAAiB,MAAjB,CADe;AAErBC,uBAASF,MAAMC,UAAN,CAAiB,SAAjB,EAA4B,QAA5B;AAFY,aAAhB,CAAP;AAID,WALO,CAAR;AAMD,SAPD;AAQD,OAjBM,CAAP;AAkBD;;;;;;IAGGH,K,GACJ,eAAYX,IAAZ,EAAkBgB,UAAlB,EAA8B;AAAA;;AAC5BC,SAAOC,MAAP,CAAc,IAAd,EAAoB,EAAClB,UAAD,EAApB,EAA4BgB,UAA5B;AACD,C;;IAGGG,e;;;;;;;yBACCnB,K,EAAM;AACT,aAAO,IAAIE,OAAJ,CAAY,UAACR,OAAD,EAAU0B,MAAV,EAAqB;AACtC,sCAAGnC,UAAUe,KAAb,EAAmBO,IAAnB,CAAwB,gBAAQ;AAC9B,cAAMc,IAAI,kBAAQC,IAAR,CAAaC,IAAb,CAAV;AACA,cAAMC,OAAOH,EAAE,uBAAF,EAA2BI,IAA3B,CAAgC,MAAhC,CAAb;;AAEA,cAAID,IAAJ,EACE9B,QAAQ,IAAIE,IAAJ,CAAS4B,KAAK1B,KAAL,CAAW,GAAX,EAAgBG,GAAhB,EAAT,EAAgCD,KAAhC,CAAR,EADF,KAGEoB,OAAO,IAAIM,KAAJ,CAAU,oBAAV,CAAP;AACH,SARD;AASD,OAVM,CAAP;AAWD;;;;;;kBAGYP,e","file":"lonelyplanet.js","sourcesContent":["import qs from 'qs';\nimport url from 'url';\nimport cheerio from 'cheerio';\nimport rp from 'request-promise';\n\nconst baseURL = 'https://www.lonelyplanet.com/';\n\nfunction getEndpoint(id, type = 'sights', limit = 1000, offset = 0) {\n  const query = qs.stringify({\n    'filter[poi][poi_type][equals]': type,\n    'filter[poi][place_id][has_ancestor]': id,\n    'page[limit]': limit,\n    'page[offset]': offset,\n  }, {encode: false});\n\n  return url.resolve(baseURL, `a/poi-sig/${id}?resource=` + encodeURIComponent('/pois?' + query));\n}\n\nclass City {\n  constructor(id, query) {\n    let parts = query.split('/');\n\n    this.id = id;\n    this.country = parts[0];\n    this.city = parts.pop();\n  }\n\n  sights() {\n    return new Promise((resolve) => {\n      const options = {\n        url: getEndpoint(this.id),\n        json: true,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      };\n\n      rp(options).then(result => {\n        resolve(result.data.map(sight => {\n          return new Sight(this, {\n            name: sight.attributes['name'],\n            address: sight.attributes['address']['street'],\n          });\n        }));\n      })\n    });\n  }\n}\n\nclass Sight {\n  constructor(city, parameters) {\n    Object.assign(this, {city}, parameters);\n  }\n}\n\nclass LonelyPlanetAPI {\n  city(city) {\n    return new Promise((resolve, reject) => {\n      rp(baseURL + city).then(body => {\n        const $ = cheerio.load(body);\n        const href = $('.food-and-drink__more').attr('href');\n\n        if (href)\n          resolve(new City(href.split('/').pop(), city));\n        else\n          reject(new Error('href was not found'))\n      });\n    });\n  }\n}\n\nexport default LonelyPlanetAPI;"]}