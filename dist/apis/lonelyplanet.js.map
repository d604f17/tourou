{"version":3,"sources":["../../src/apis/lonelyplanet.js"],"names":["baseURL","getEndpoint","id","type","limit","offset","query","stringify","encode","resolve","encodeURIComponent","City","parts","split","country","city","pop","Promise","options","url","json","headers","then","result","data","map","Sight","name","sight","attributes","address","parameters","Object","assign","LonelyPlanetAPI","reject","$","load","body","href","attr","Error"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA,UAAU,+BAAhB;;AAEA,SAASC,WAAT,CAAqBC,EAArB,EAAoE;AAAA,MAA3CC,IAA2C,uEAApC,QAAoC;AAAA,MAA1BC,KAA0B,uEAAlB,IAAkB;AAAA,MAAZC,MAAY,uEAAH,CAAG;;AAClE,MAAMC,QAAQ,aAAGC,SAAH,CAAa;AACzB,qCAAiCJ,IADR;AAEzB,2CAAuCD,EAFd;AAGzB,mBAAeE,KAHU;AAIzB,oBAAgBC;AAJS,GAAb,EAKX,EAACG,QAAQ,KAAT,EALW,CAAd;;AAOA,SAAO,cAAIC,OAAJ,CAAYT,OAAZ,EAAqB,eAAaE,EAAb,kBAA8BQ,mBAAmB,WAAWJ,KAA9B,CAAnD,CAAP;AACD;;IAEKK,I;AACJ,gBAAYT,EAAZ,EAAgBI,KAAhB,EAAuB;AAAA;;AACrB,QAAIM,QAAQN,MAAMO,KAAN,CAAY,GAAZ,CAAZ;;AAEA,SAAKX,EAAL,GAAUA,EAAV;AACA,SAAKY,OAAL,GAAeF,MAAM,CAAN,CAAf;AACA,SAAKG,IAAL,GAAYH,MAAMI,GAAN,EAAZ;AACD;;;;6BAEQ;AAAA;;AACP,aAAO,IAAIC,OAAJ,CAAY,UAACR,OAAD,EAAa;AAC9B,YAAMS,UAAU;AACdC,eAAKlB,YAAY,MAAKC,EAAjB,CADS;AAEdkB,gBAAM,IAFQ;AAGdC,mBAAS;AACP,4BAAgB;AADT;AAHK,SAAhB;;AAQA,sCAAGH,OAAH,EAAYI,IAAZ,CAAiB,kBAAU;AACzBb,kBAAQc,OAAOC,IAAP,CAAYC,GAAZ,CAAgB,iBAAS;AAC/B,mBAAO,IAAIC,KAAJ,QAAgB;AACrBC,oBAAMC,MAAMC,UAAN,CAAiB,MAAjB,CADe;AAErBC,uBAASF,MAAMC,UAAN,CAAiB,SAAjB,EAA4B,QAA5B;AAFY,aAAhB,CAAP;AAID,WALO,CAAR;AAMD,SAPD;AAQD,OAjBM,CAAP;AAkBD;;;;;;IAGGH,K,GACJ,eAAYX,IAAZ,EAAkBgB,UAAlB,EAA8B;AAAA;;AAC5BC,SAAOC,MAAP,CAAc,IAAd,EAAoB,EAAClB,UAAD,EAApB,EAA4BgB,UAA5B;AACD,C;;IAGGG,e;;;;;;;yBACCnB,K,EAAM;AACT,aAAO,IAAIE,OAAJ,CAAY,UAACR,OAAD,EAAU0B,MAAV,EAAqB;AACtC,sCAAGnC,UAAUe,KAAb,EAAmBO,IAAnB,CAAwB,gBAAQ;AAC9B,cAAMc,IAAI,kBAAQC,IAAR,CAAaC,IAAb,CAAV;AACA,cAAMC,OAAOH,EAAE,uBAAF,EAA2BI,IAA3B,CAAgC,MAAhC,CAAb;;AAEA,cAAID,IAAJ,EACE9B,QAAQ,IAAIE,IAAJ,CAAS4B,KAAK1B,KAAL,CAAW,GAAX,EAAgBG,GAAhB,EAAT,EAAgCD,KAAhC,CAAR,EADF,KAGEoB,OAAO,IAAIM,KAAJ,CAAU,oBAAV,CAAP;AACH,SARD;AASD,OAVM,CAAP;AAWD;;;;;;kBAGYP,e","file":"lonelyplanet.js","sourcesContent":["import qs from 'qs';\r\nimport url from 'url';\r\nimport cheerio from 'cheerio';\r\nimport rp from 'request-promise';\r\n\r\nconst baseURL = 'https://www.lonelyplanet.com/';\r\n\r\nfunction getEndpoint(id, type = 'sights', limit = 1000, offset = 0) {\r\n  const query = qs.stringify({\r\n    'filter[poi][poi_type][equals]': type,\r\n    'filter[poi][place_id][has_ancestor]': id,\r\n    'page[limit]': limit,\r\n    'page[offset]': offset,\r\n  }, {encode: false});\r\n\r\n  return url.resolve(baseURL, `a/poi-sig/${id}?resource=` + encodeURIComponent('/pois?' + query));\r\n}\r\n\r\nclass City {\r\n  constructor(id, query) {\r\n    let parts = query.split('/');\r\n\r\n    this.id = id;\r\n    this.country = parts[0];\r\n    this.city = parts.pop();\r\n  }\r\n\r\n  sights() {\r\n    return new Promise((resolve) => {\r\n      const options = {\r\n        url: getEndpoint(this.id),\r\n        json: true,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      };\r\n\r\n      rp(options).then(result => {\r\n        resolve(result.data.map(sight => {\r\n          return new Sight(this, {\r\n            name: sight.attributes['name'],\r\n            address: sight.attributes['address']['street'],\r\n          });\r\n        }));\r\n      })\r\n    });\r\n  }\r\n}\r\n\r\nclass Sight {\r\n  constructor(city, parameters) {\r\n    Object.assign(this, {city}, parameters);\r\n  }\r\n}\r\n\r\nclass LonelyPlanetAPI {\r\n  city(city) {\r\n    return new Promise((resolve, reject) => {\r\n      rp(baseURL + city).then(body => {\r\n        const $ = cheerio.load(body);\r\n        const href = $('.food-and-drink__more').attr('href');\r\n\r\n        if (href)\r\n          resolve(new City(href.split('/').pop(), city));\r\n        else\r\n          reject(new Error('href was not found'))\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport default LonelyPlanetAPI;"]}