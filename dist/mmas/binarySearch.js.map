{"version":3,"sources":["../../src/mmas/binarySearch.js"],"names":["halfnhalf","iterations","maxDistance","waypoints","Promise","count","bestRoute","bestRouteDistance","Number","MIN_SAFE_INTEGER","loop","min","max","then","route","boxes","coordinates","_tour","map","vertex","y","x","query","mode","origin","shift","destination","pop","join","legs","result","routes","distances","leg","distance","value","_realDistance","reduce","a","b","length","localMin","localMax","Math","round","catch","console","error","resolve"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;;;AAEA,IAAMA,YAAY,SAAZA,SAAY,CAACC,UAAD,EAAaC,WAAb,EAA0BC,SAA1B,EAAwC;AACxD,SAAO,IAAIC,OAAJ,CAAY,mBAAW;AAC5B,QAAIC,QAAQ,CAAZ;AACA,QAAIC,kBAAJ;AACA,QAAIC,oBAAoBC,OAAOC,gBAA/B;;AAEA,KAAC,SAASC,IAAT,CAAcC,GAAd,EAAmBC,GAAnB,EAAwB;AACvB,UAAIP,QAAQJ,UAAZ,EAAwB;AACtB,UAAEI,KAAF;;AAEA,wBAAIF,SAAJ,EAAeU,IAAf,CAAoB,iBAAS;AAC3B,cAAMC,QAAQ,qBAAKX,SAAL,EAAgBY,KAAhB,EAAuB,EAACb,aAAaU,GAAd,EAAvB,CAAd;;AAEA,cAAMI,cAAcF,MAAMG,KAAN,CAAYC,GAAZ,CAAgB,kBAAU;AAC5C,mBAAOC,OAAOC,CAAP,GAAW,GAAX,GAAiBD,OAAOE,CAA/B;AACD,WAFmB,CAApB;;AAIA,+BAAWC,KAAX,CAAiB;AACfC,kBAAM,SADS;AAEfC,oBAAQR,YAAYS,KAAZ,EAFO;AAGfC,yBAAaV,YAAYW,GAAZ,EAHE;AAIfxB,uBAAWa,YAAYY,IAAZ,CAAiB,GAAjB;AAJI,WAAjB,EAKGf,IALH,CAKQ,kBAAU;AAChB,gBAAIgB,OAAOC,OAAOC,MAAP,CAAc,CAAd,EAAiBF,IAA5B;AACA,gBAAIG,YAAYH,KAAKX,GAAL,CAAS;AAAA,qBAAOe,IAAIC,QAAJ,CAAaC,KAApB;AAAA,aAAT,CAAhB;AACArB,kBAAMsB,aAAN,GAAsBJ,UAAUK,MAAV,CAAiB,UAACC,CAAD,EAAIC,CAAJ;AAAA,qBAAUD,IAAIC,CAAd;AAAA,aAAjB,CAAtB;AACAzB,kBAAMsB,aAAN,IAAuB,QAAQP,KAAKW,MAAL,GAAc,CAAtB,CAAvB;;AAEA,gBAAI,OAAOlC,SAAP,KAAqB,WAAzB,EAAsC;AACpCA,0BAAYQ,KAAZ;AACAP,kCAAoBO,MAAMsB,aAA1B;AACD;;AAED,gBAAIK,WAAW9B,GAAf;AAAA,gBAAoB+B,WAAW9B,GAA/B;;AAEA,gBAAI+B,KAAKC,KAAL,CAAWjC,GAAX,MAAoBgC,KAAKC,KAAL,CAAWhC,GAAX,CAAxB,EAAyC;AACvCP,sBAAQJ,UAAR;AACAK,0BAAYQ,KAAZ;AACAP,kCAAoBO,MAAMsB,aAA1B;AACD,aAJD,MAIO,IAAItB,MAAMsB,aAAN,GAAsBlC,WAA1B,EAAuC;AAC5CwC,yBAAW/B,MAAM,CAACC,MAAMD,GAAP,IAAc,CAA/B;AACD,aAFM,MAEA,IAAIG,MAAMsB,aAAN,GAAsBlC,WAA1B,EAAuC;AAC5C,kBAAIY,MAAMsB,aAAN,GAAsB7B,iBAAtB,IAA2CA,oBAAoBL,WAAnE,EAAgF;AAC9EI,4BAAYQ,KAAZ;AACAP,oCAAoBO,MAAMsB,aAA1B;AACD;AACDK,yBAAW7B,GAAX;AACA8B,yBAAW9B,MAAM,CAACA,MAAMD,GAAP,IAAc,CAA/B;AACD,aAPM,MAOA;AACLN,sBAAQJ,UAAR;AACAK,0BAAYQ,KAAZ;AACAP,kCAAoBO,MAAMsB,aAA1B;AACD;AACD1B,iBAAK+B,QAAL,EAAeC,QAAf;AACD,WArCD;AAsCD,SA7CD,EA6CGG,KA7CH,CA6CSC,QAAQC,KA7CjB;AA8CD,OAjDD,MAiDO;AACLC,gBAAQ1C,SAAR;AACD;AACF,KArDD,EAqDG,CArDH,EAqDMJ,WArDN;AAsDD,GA3DM,CAAP;AA4DD,CA7DD;;kBA+DeF,S","file":"binarySearch.js","sourcesContent":["import {one} from '../strategies/index';\nimport mmas from './index';\nimport directions from '../directions';\n\nconst halfnhalf = (iterations, maxDistance, waypoints) => {\n  return new Promise(resolve => {\n    let count = 0;\n    let bestRoute;\n    let bestRouteDistance = Number.MIN_SAFE_INTEGER;\n\n    (function loop(min, max) {\n      if (count < iterations) {\n        ++count;\n\n        one(waypoints).then(boxes => {\n          const route = mmas(waypoints, boxes, {maxDistance: max});\n\n          const coordinates = route._tour.map(vertex => {\n            return vertex.y + ',' + vertex.x;\n          });\n\n          directions.query({\n            mode: 'walking',\n            origin: coordinates.shift(),\n            destination: coordinates.pop(),\n            waypoints: coordinates.join('|'),\n          }).then(result => {\n            let legs = result.routes[0].legs;\n            let distances = legs.map(leg => leg.distance.value);\n            route._realDistance = distances.reduce((a, b) => a + b);\n            route._realDistance += 2500 * (legs.length - 1);\n\n            if (typeof bestRoute === 'undefined') {\n              bestRoute = route;\n              bestRouteDistance = route._realDistance;\n            }\n\n            let localMin = min, localMax = max;\n\n            if (Math.round(min) === Math.round(max)) {\n              count = iterations;\n              bestRoute = route;\n              bestRouteDistance = route._realDistance;\n            } else if (route._realDistance > maxDistance) {\n              localMax = min + (max - min) / 2;\n            } else if (route._realDistance < maxDistance) {\n              if (route._realDistance > bestRouteDistance || bestRouteDistance > maxDistance) {\n                bestRoute = route;\n                bestRouteDistance = route._realDistance;\n              }\n              localMin = max;\n              localMax = max + (max - min) / 2;\n            } else {\n              count = iterations;\n              bestRoute = route;\n              bestRouteDistance = route._realDistance;\n            }\n            loop(localMin, localMax);\n          });\n        }).catch(console.error);\n      } else {\n        resolve(bestRoute);\n      }\n    })(0, maxDistance);\n  });\n};\n\nexport default halfnhalf;\n"]}